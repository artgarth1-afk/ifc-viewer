<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>IFC Viewer (WebIFC + Xeokit)</title>
  <style>
    body { margin:0; font-family: sans-serif; }
    #viewer { width:100%; height:90vh; }
    #info { height:10vh; overflow:auto; padding:5px; background:#f9f9f9; border-top:1px solid #ccc; }
  </style>
</head>
<body>
  <div id="viewer"></div>
  <div id="info">Здесь будет информация об объекте</div>

  <script type="module">
    import { Viewer } from './xeokit-sdk.es.js';
    import { IfcAPI } from "https://cdn.jsdelivr.net/npm/web-ifc@0.0.44/web-ifc-api.js";

    // Создаём Viewer
    const viewer = new Viewer({ canvasId: "viewer" });
    viewer.camera.eye = [20, 20, 20];
    viewer.camera.look = [0, 0, 0];
    viewer.camera.up = [0, 1, 0];
    viewer.cameraControl.setNavigationMode("orbit");

    // Инициализация WebIFC
    const ifcAPI = new IfcAPI();
    await ifcAPI.Init();

    // Загружаем IFC
    const modelData = await fetch("model.ifc").then(r => r.arrayBuffer());
    const modelID = ifcAPI.OpenModel(modelData);

    console.log("IFC открыт:", modelID);

    // Получаем список элементов IFC
    const allItems = ifcAPI.GetAllItemsOfType(modelID, ifcAPI.typesIfc.IFCBUILDINGELEMENT, true);
    console.log("Элементы IFC:", allItems);

    // Простейшее отображение: создаём примитивы в Viewer
    // (для реальной геометрии нужен парсинг mesh через WebIFC)
    for (const item of allItems) {
      const props = ifcAPI.GetLine(modelID, item);
      viewer.scene.addEntity({
        id: "ifc_" + item,
        isObject: true,
        aabb: [-1,-1,-1, 1,1,1], // временный куб
        meta: props
      });
    }

    // Подсветка при клике
    let selectedEntity = null;
    viewer.cameraControl.on("picked", e => {
      if (e.entity) {
        viewer.scene.setObjectsHighlighted(viewer.scene.objects, false);
        e.entity.highlighted = true;
        selectedEntity = e.entity;
        document.getElementById("info").innerHTML =
          `<b>ID:</b> ${e.entity.id}<br>` +
          `<b>Props:</b> ${JSON.stringify(e.entity.meta)}`;
      }
    });
  </script>
</body>
</html>
